# java-convenience-store-precourse

## 💬 우테코 프리코스 4주차 - 편의점

**`구매자의 할인 혜택과 재고 상황을 고려하여 최종 결제 금액을 계산하고 안내하는 결제 시스템을 구현한다.`**

---

### ✏️ 구현할 기능 목록

#### 1. 손님(Customer)
**상점 방문**
- [x] 손님이 상점에 방문한다
  - [x] 안내 문구를 확인한다.
  - [x] 현재 보유하고 있는 재고 상태를 조회한다.
  - [x] 구매할 상품 목록을 작성하여 포스기에 입력한다
    - [x] 입력은 `[콜라-3],[에너지바-5]`와 같은 형태로 이루어져야 한다.

**응답하기**
- [x] 포스기가 안내하는 내용에 대해 `(Y/N)`을 입력하여 응답한다.

**영수증 수령**
- [x] 본인이 구매한 내용에 대한 영수증을 요청할 수 있다.

#### 2. 재고(Product)
**재고 저장**
- [x] 프로젝트가 시작되면, 정해진 파일을 읽어와 재고 정보를 정리할 수 있다.
    - [x] 재고를 저장소에 저장할 수 있다.
    - [x] 프로모션이 있다면, 프로모션 내용(Promotion)을 붙일 수 있다.

**구매 요청시**
- [x] 입력한 상품 이름으로 재고 현황을 파악할 수 있다.
- [x] 적용할 수 있는 프로모션이 있는지 조회를 요청한다.
- [x] 구매 내용과 조회한 프로모션 내용을 기반으로 프로모션 적용 갯수를 확인한다.
- [x] 고객이 상품을 최종적으로 구매하면, 재고를 차감하여 최신 정보를 유지할 수 있다.

#### 3. 프로모션 (Promotion)
**프로모션 정리**
- [x] 프로젝트가 시작되면, 정해진 파일을 읽어 와 프로모션 행사 내용을 정리할 수 있다.
  - [x] 프로모션 행사 내용을 저장소에 저장할 수 있다.

**프로모션 제공**
- [x] 오늘 날짜와 장바구니 목록을 기반으로 어떤 프로모션이 적용될 수 있는지 확인할 수 있다.

**멤버십 할인**
- [x] 멤버십 할인 금액을 계산하여 제공할 수 있다.
  - [x] 프로모션 미적용 금액의 30%가 할인 금액으로 제공된다.
  - [x] 멤버십 할인의 최대 한도는 `8,000원`이다.


#### 4. 편의점(Store)
**구매 요청 처리**
- [x] 구매 요청이 들어오면, 손님이 입력한 내용을 기반으로 결제 가능 여부를 확인한다.
  - [x] 재고 여유 상태의 확인을 요청한다.
  - [x] 적용할 수 있는 프로모션 내용에 대해 조회한다.

**안내하기**
- [x] 추가 사항에 대해 안내를 하고,`(Y/N)`을 입력받는다.
  - [x] 프로모션 적용이 가능한 상품을 적게 가져왔을 때, 추가로 가져오면 혜택을 받을 수 있음
  - [x] 프로모션 재고가 부족하여 일부 수량을 정가로 결제해야 한다
  - [x] 멤버십 할인을 받을 수 있다
  - [x] 모든 단계가 마무리 된 후, 추가 구매를 진행할지 입력받는다.

**영수증 출력**
- [x] 구매 상품 내역을 확인할 수 있다.
  - [x] 구매한 상품명, 수량, 가격으로 표현한다.
- [x] 증정 상품 내역(무료로 제공된 증정 상품의 목록)을 확인할 수 있다.
- [x] 금액 정보를 확인할 수 있다.
  - [x] 총 구매액, 행사 할인, 멤버십 할인, 내실 돈(최종 결제 금액)
- [x] 영수증의 구성 요소를 보기 좋게 정렬하여 쉽게 금액과 수량을 확인할 수 있게 한다.

---

### 😈 예외 사항
사용자가 잘못된 값을 입력할 경우, `IllegalArgumentException`을 발생시키고, `[ERROR]`로 시작하는 에러메세지를 출력 후,
**그 부분부터 입력을 다시 받으며**, `Exception`이 아닌 **명확한 예외 유형**을 처리한다.

- [x] 사전에 협의된 행 제목(키 값)과 실제 파일의 행 제목의 갯수와 순서가 일치해야 한다.
- [x] 구매할 상품의 입력이 `[상품명-N]`과 같이 입력되어야 하며, 다수의 품목은 쉼표 `(,)`로 구분되어야 한다.
- [x] 존재하지 않는 상품에 대한 구매는 요청할 수 없다.
- [x] 현재 보유하고 있는 재고보다 많은 물량에 대한 구매는 요청할 수 없다.
- [x] 정해진 규격을 지키고 있어야 한다 (prefix, suffix, separator)
- [x] 구매할 수량에 음수가 입력될 수 없다`(ex. [콜라--10])`
- [x] 구매할 수량에 0이 입력될 수 없다`(ex. [콜라-0])`
- [x] 구매할 수량이 0으로 시작되는 값으로 입력될 수 없다 `ex. [콜라-012]`
- [x] 구분자`(-)` 뒤로 공백이 존재할 수 없다 `ex. [콜라- 10]`
- [x] 숫자로 변환될 수 없는 값이 갯수로 주어질 수 없다
- [x] 추가 질문에 대해 `(Y/N)`로만 대답할 수 있어야 한다

---

### 🖥️ 예시

```console
안녕하세요. W편의점입니다.
현재 보유하고 있는 상품입니다.

- 콜라 1,000원 7개 탄산2+1
- 콜라 1,000원 10개

... (재고 목록 출력)

- 컵라면 1,700원 1개 MD추천상품
- 컵라면 1,700원 10개

구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])
[콜라-10]

현재 콜라 4개는 프로모션 할인이 적용되지 않습니다. 그래도 구매하시겠습니까? (Y/N)
Y

멤버십 할인을 받으시겠습니까? (Y/N)
N

==============W 편의점================
상품명		    수량	            금액
콜라		        10 	          10,000
==============증	정===============
콜라		        2
====================================
총구매액		    10	          10,000
행사할인			              -2,000
멤버십할인			                    -0
내실돈			               8,000

감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)
Y

안녕하세요. W편의점입니다.

...
```

---

### 🤔 구현 과정

#### 생각 해보기(Before)
1. 파일의 첫 번째 줄(키 값)을 객체로 만들 때 유용하게 사용할 수 없을까?

2. 어떻게 수량을 다 계산한 뒤에 사용자에게 묻고, 물은 내용을 기반으로 결제할 내용을 다시 수정할 수 있을까?

#### 생각 해본 뒤(After)
1. 파일의 첫 번째 줄을 유동적으로 생성하는 데 사용하고 싶어 `Map`으로 처리하는 등 여러 방식으로 도전해 보았는데, 
그런 방식을 생각하면 엔티티 구조를 미리 선언할 수 없어 가독성과 접근성이 매우 떨어지고, 일반 문자열 형식으로 저장해야 하기에 
계속 운용하기가 부담스러워진다는 생각이 들어서, 이를 사전에 설정한다는 의미의 상수로 Enum 클래스를 통해 선언하여 들어와야 하는 값이 
제대로 된 위치와 순서, 갯수로 올 수 있는지 검사하는 것으로 어느정도 해소하게 되었다.

2. 어떤 유형의 추가 조건이 발생했는지를 Enum으로 분류하였고, conditionalQuantity라는 변수를 통해 사용자가 대답하는 유형에 따라
해당 값으로 수량을 추가하거나 감소할 수 있도록 처리하였다

#### 마무리하며
<DTO에 대하여>
3주차 미션을 진행할 때, 코드 리뷰를 통해 피드백을 받으면서 마지막 미션에서는 DTO 개념을 적용하는 것이 하나의 목표였다.
그리고 그걸 생각해내지 못했으면 도대체 무슨 일이 벌어졌을지 모를 정도로 복잡한 과정이었기에... 큰 도움을 받았다
특히 특별한 클래스중 하나인 Enum을 저번 주에 활용하고자 하였다면, DTO를 Record 클래스로 구현하면서
편리함을 많이 느꼇고, 메서드가 한 가지 일만 할 수 있도록 분리하는데에도 큰 도움이 된 것 같았다.
다만, 프로젝트 내부적으로 입출력이 돌아가는 구조라 어떤게 Request고 어떤게 Response인지 구분하는게
조금 힘들었지만, 나름대로 분류하고, 단지 담기 위한것은 따로 빼두려고 노력했다.

<마지막 구현에 대하여>
문제를 보자마자 간단하지 않을거라고 예상은 했지만, 예상한 시간을 훌쩍 넘기고 말았다.
특히, 프로모션을 적용하는 과정의 프로세스에 대해 계속 생각도 해보고, 종이에도 그려보고,
따로 코드도 작성해보고 하면서 하루를 통째로 프로모션 기능 구현에 사용했던 것 같다.
또한, 내가 생각하는 조건들이 너무 복잡한 것인지 결국 10줄을 넘기지 말라는 것을 지키지 못해서,
아쉬움이 많이 남는다. 물론 10줄이 중요한 것이 아니라 되도록 메서드가 한 가지 일만 하도록 하는것이
주 목적일 것이기 때문에. 그 부분에 대해서는 자고 일어나서 다시 코드를 살펴보면 어떻게 느껴질지 모르겠지만
지금 현재 상황에서는 내가 할 수 있는 최선을 다 했다고 생각한다. 시간은 많이 걸렸지만 내 손이 자연스럽게 
다음에 뭘 해야할지 알고 움직이고 있는 것 같아서 나름 성장했다는 느낌을 받기도 했다. (물론 마지막에는 좀 우당탕탕 이었지만...)